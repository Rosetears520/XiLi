# 数据处理总结文档

> 本文档为数据分析工具箱的项目级总结模板，记录每次数据处理运行的环境、输入、处理步骤、结果、异常与可复现性信息。

---

## 1. 环境 (Environment)

| 项目 | 版本/配置 |
|------|----------|
| Python 版本 | 3.12.8 |
| 包管理工具 | uv + .venv |
| 运行命令 | `uv run -- python <script.py> [args...]` |

---

## 2. 输入 (Input)

### 2.1 工具输入要求

#### 核心分析工具

| 工具名称 | 输入格式 | 必需列/参数 | 说明 |
|----------|----------|-------------|------|
| 熵权 TOPSIS | csv 和 excel | 数据列、可选：分组列(group_cols)、年份列(year_col)、ID列(id_cols)、负向指标(negative_indicators) | 支持多列分组、年份分组等多种模式 |
| 秩和检验 | csv 和 excel | 数据列、题目列(question_cols) 或 分组列(group_cols)、因变量列(dv_col) | 支持 questions 和 group 两种模式 |

#### 描述统计/填补工具

| 工具名称 | 输入格式 | 必需列/参数 | 说明 |
|----------|----------|-------------|------|
| 计算年份平均值 | csv 和 excel | 列名列表 (cols)、可选：重命名对 | 按股票代码等计算指定列的平均值 |
| 平均增长率 | csv 和 excel | 数据列、省份列 | 按省份分组，使用年均增长率填充缺失值 |

#### 聚类分析工具

| 工具名称 | 输入格式 | 必需列/参数 | 说明 |
|----------|----------|-------------|------|
| K-means | csv 和 excel | 数值数据列 | 自动确定最佳聚类数并生成可视化结果 |

#### 主题模型/NLP 工具

| 工具名称 | 输入格式 | 必需列/参数 | 说明 |
|----------|----------|-------------|------|
| SnowNLP情感分析 | csv 和 excel + 模型文件 | 模型路径、数据列 | 对 csv 和 excel 数据进行情感分析并生成分布图表 |
| LDA模型 | 分词文本文件 (.txt) | 分词后的文本（每行一个文档） | 生成主题词云和可视化结果 |
| LDA困惑度和一致性 | 分词文本文件 (.txt) | 分词后的文本、主题数范围 | 评估不同主题数的 LDA 模型 |
| SnowNLP训练 | 正面/负面语料文件 (.txt) | 正面语料、负面语料 | 训练情感分析模型 |

---

## 3. 处理步骤 (Processing Steps)

### 3.1 工具处理流程

#### 熵权 TOPSIS
1. 读取 csv 和 excel 数据文件
2. 数据预处理（处理缺失值、异常值）
3. 标准化处理（应用 `eps_shift` 非负平移常数）
4. 计算熵权
5. 应用 TOPSIS 方法计算贴近度
6. （可选）按分组列进行分组计算
7. 输出结果到 Excel 文件

#### 秩和检验
1. 读取 csv 和 excel 数据文件
2. 按模式（questions/group）分组数据
3. 执行非参数检验（Mann-Whitney U 或 Kruskal-Wallis H）
4. 计算统计量和 p 值
5. 根据显著性水平判断差异显著性
6. 输出结果到 Excel 文件

---

## 4. 结果 (Output)

| 工具名称 | 输出文件类型 | 默认文件名/路径 | 说明 |
|----------|--------------|-----------------|------|
| 熵权 TOPSIS | Excel (.xlsx) | `entropy_topsis.xlsx` | 包含熵权、标准化值、贴近度等 |
| 秩和检验 | Excel (.xlsx) | `rank_tests.xlsx` | 包含统计量、p值、显著性结果 |
| 计算年份平均值 | csv 和 excel | `yearly_averages.xlsx` | 各列的年份平均值 |
| 平均增长率 | csv 和 excel | `average_growth_rate_result.csv` | 填充后的数据 |
| K-means | Excel + 图像 | `outputs/kmeans/` | 聚类结果、评估指标、可视化图表 |
| SnowNLP情感分析 | Excel + 图像 | `comments_with_sentiment.xlsx`, 分布图 | 带情感分数的数据和分布图 |

---

## 8. 数据集处理政策

- csv 和 excel 原始导出和采集数据不得直接提交到仓库，非敏感示例应保留在 `tests/fixtures/` 或 docs/ 里。
- 每次运行的 `runs/<timestamp_uuid>/` 目录属于输出产物，应通过 .gitignore 忽略，方便自动化生成。
- 提交前确保 csv 和 excel 输入文件的敏感字段已脱敏或使用样本替代。
